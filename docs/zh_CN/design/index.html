
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>LFortran Design &#8212; LFortran</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/ansi.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/translations.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../_static/lfortran-logo.svg"/>
    <link rel="index" title="索引" href="../genindex/" />
    <link rel="search" title="搜索" href="../search/" />
    <link rel="next" title="开发者教程" href="../developer_tutorial/" />
    <link rel="prev" title="LFortran 开发现状" href="../progress/" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=amber data-md-color-accent=orange>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#design" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../" title="LFortran"
           class="md-header-nav__button md-logo">
          
              <img src="../_static/lfortran-logo.svg" height="26"
                   alt="LFortran logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">LFortran Documentation</span>
          <span class="md-header-nav__topic"> LFortran Design </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search/" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/lfortran/lfortran" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    LFortran
  </div>
</a>
          </div>
        </div>
      
      
  
  <div class="md-flex__cell md-flex__cell--shrink dropdown">
    <button class="dropdownbutton">Versions</button>
    <div class="dropdown-content md-hero">
          <a title="English" href="/../en/">English</a>
      
          <a title="Bengali" href="/../bn/">Bengali</a>
      
          <a title="Czech" href="/../cs/">Czech</a>
      
          <a title="German" href="/../de/">German</a>
      
          <a title="Spanish" href="/../es/">Spanish</a>
      
          <a title="French" href="/../fr/">French</a>
      
          <a title="Japanese" href="/../ja/">Japanese</a>
      
          <a title="Dutch" href="/../nl/">Dutch</a>
      
          <a title="Polish" href="/../pl/">Polish</a>
      
          <a title="Portuguese" href="/../pt/">Portuguese</a>
      
          <a title="Russian" href="/../ru/">Russian</a>
      
          <a title="Chinese" href="/../zh_CN/">Chinese</a>
      
    </div>
  </div>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../" class="md-tabs__link">LFortran</a></li>
            
            <li class="md-tabs__item"><a href="../installation/" class="md-tabs__link">Getting started</a></li>
            
            <li class="md-tabs__item"><a href="../progress/" class="md-tabs__link">LFortran Development Status</a></li>
            
            <li class="md-tabs__item"><a href="#" class="md-tabs__link">Developers's Guide</a></li>
            
            <li class="md-tabs__item"><a href="../intrinsics/array/" class="md-tabs__link">Intrinsics</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../" title="LFortran" class="md-nav__button md-logo">
      
        <img src="../_static/lfortran-logo.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../"
       title="LFortran">LFortran Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/lfortran/lfortran" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    LFortran
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">开始</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation/" class="md-nav__link">安装</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language/" class="md-nav__link">Fortran 语言</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">LFortran 开发现状</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../progress/" class="md-nav__link">LFortran 开发现状</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../progress/#topics" class="md-nav__link">话题</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">开发者指南</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> LFortran Design </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">LFortran Design</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#design--page-root" class="md-nav__link">LFortran Design</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#high-level-overview" class="md-nav__link">高级概述</a>
        </li>
        <li class="md-nav__item"><a href="#asr-design-details" class="md-nav__link">ASR 设计细节</a>
        </li>
        <li class="md-nav__item"><a href="#notes" class="md-nav__link">注意：</a>
        </li>
        <li class="md-nav__item"><a href="#fortran-2008" class="md-nav__link">Fortran 2008</a>
        </li>
        <li class="md-nav__item"><a href="#lfortran-extension" class="md-nav__link">LFortran 扩展</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#example-1" class="md-nav__link">示例 1</a>
        </li>
        <li class="md-nav__item"><a href="#example-2" class="md-nav__link">示例 2</a>
        </li>
        <li class="md-nav__item"><a href="#example-3" class="md-nav__link">示例 3</a>
        </li>
        <li class="md-nav__item"><a href="#example-4" class="md-nav__link">示例 4</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#design-considerations" class="md-nav__link">设计注意事项</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="#high-level-overview" class="md-nav__link">高级概述</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#asr-design-details" class="md-nav__link">ASR 设计细节</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#notes" class="md-nav__link">注意：</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#fortran-2008" class="md-nav__link">Fortran 2008</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#lfortran-extension" class="md-nav__link">LFortran 扩展</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#design-considerations" class="md-nav__link">设计注意事项</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../developer_tutorial/" class="md-nav__link">开发者教程</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../ast_and_asr/" class="md-nav__link">AST 和 ASR 之间的区别</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../contributing/" class="md-nav__link">贡献</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">LFortran 内置函数</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../intrinsics/array/" class="md-nav__link">数组内置函数</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../intrinsics/bit/" class="md-nav__link">位操作内置函数</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../intrinsics/character/" class="md-nav__link">字符内置函数</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../intrinsics/kind-type/" class="md-nav__link">种类类型内置函数</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../intrinsics/mathematical/" class="md-nav__link">数学内置函数</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../intrinsics/numeric/" class="md-nav__link">数值内置函数</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../intrinsics/misc/" class="md-nav__link">其他内置函数</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">LFortran ASR Nodes</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../asr/asr_nodes/cast_kind_nodes/cast_kind/" class="md-nav__link">cast_kind</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../asr/asr_nodes/expression_nodes/expression_nodes/" class="md-nav__link">ASR Expression Nodes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../asr/asr_nodes/kinds_nodes/kinds/" class="md-nav__link">kinds</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../asr/asr_nodes/statement_nodes/statement_nodes/" class="md-nav__link">ASR Statement Nodes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../asr/asr_nodes/symbol_nodes/symbol/" class="md-nav__link">symbol</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../asr/asr_nodes/symbol_nodes/program/" class="md-nav__link">Program</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../asr/asr_nodes/type_nodes/ttype/" class="md-nav__link">ttype</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#design--page-root" class="md-nav__link">LFortran Design</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#high-level-overview" class="md-nav__link">高级概述</a>
        </li>
        <li class="md-nav__item"><a href="#asr-design-details" class="md-nav__link">ASR 设计细节</a>
        </li>
        <li class="md-nav__item"><a href="#notes" class="md-nav__link">注意：</a>
        </li>
        <li class="md-nav__item"><a href="#fortran-2008" class="md-nav__link">Fortran 2008</a>
        </li>
        <li class="md-nav__item"><a href="#lfortran-extension" class="md-nav__link">LFortran 扩展</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#example-1" class="md-nav__link">示例 1</a>
        </li>
        <li class="md-nav__item"><a href="#example-2" class="md-nav__link">示例 2</a>
        </li>
        <li class="md-nav__item"><a href="#example-3" class="md-nav__link">示例 3</a>
        </li>
        <li class="md-nav__item"><a href="#example-4" class="md-nav__link">示例 4</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#design-considerations" class="md-nav__link">设计注意事项</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="lfortran-design">
<h1 id="design--page-root">LFortran Design<a class="headerlink" href="#design--page-root" title="永久链接至标题">¶</a></h1>
<section id="high-level-overview">
<h2 id="high-level-overview">高级概述<a class="headerlink" href="#high-level-overview" title="永久链接至标题">¶</a></h2>
<p>LFortran 围绕两个独立的模块 AST 和 ASR 构建，这两个模块都是独立的（完全独立于 LFortran 的其余部分），鼓励用户将它们独立用于其他应用程序并在其上构建工具：</p>
<ul class="simple">
<li><p>抽象语法树 (AST)，模块 <code class="docutils literal notranslate"><span class="pre">lfortran.ast</span></code>：表示任何 Fortran 源代码，严格基于语法，不包含语义。 AST 模块可以将自身转换为 Fortran 源代码。</p></li>
<li><p>抽象语义表示 (ASR)，模块 <code class="docutils literal notranslate"><span class="pre">lfortran.asr</span></code>：表示有效的 Fortran 源代码，包括所有语义。不允许使用无效的 Fortran 代码（将给出错误）。 ASR 模块可以将自身转换为 AST。</p></li>
</ul>
<p>LFortran 编译器由以下独立阶段组成：</p>
<ul class="simple">
<li><p>解析：将 Fortran 源代码转换为 AST</p></li>
<li><p>语义：将 AST 转换为 ASR</p></li>
<li><p>高级优化：将 ASR 优化为可能更快/更简单的 ASR（内联函数、消除冗余表达式或语句等）</p></li>
<li><p>LLVM IR 代码生成和较低级别的优化：将 ASR 转换为 LLVM IR。此阶段还执行所有其他不产生 ASR，但在传递给 LLVM IR 之前仍然有意义的优化。</p></li>
<li><p>机器代码生成：LLVM 然后进行所有优化并生成机器代码（例如二进制可执行文件、库、目标文件，或者使用 JIT 作为交互式 LFortran 会话的一部分或在 Jupyter 内核中加载和执行）。</p></li>
</ul>
<p>LFortran 被构造为一个库，因此可以使用解析器获取 AST 并对其进行处理，或者然后可以使用语义分析器获取 ASR 并对其进行处理。可以直接生成 ASR（例如，从 SymPy），然后转换为 AST 和 Fortran 源代码，或者使用 LFortran 直接将其编译为机器代码。换句话说，可以使用 LFortran 在三种等效表示之间轻松转换：</p>
<ul class="simple">
<li><p>Fortran 源代码</p></li>
<li><p>抽象语法树 (AST)</p></li>
<li><p>抽象语义表示 (ASR)</p></li>
</ul>
<p>它们在以下意义上都是等价的：</p>
<ul class="simple">
<li><p>任何 ASR 始终可以转换为等效的 AST</p></li>
<li><p>任何 AST 始终可以转换为等效的 Fortran 源代码</p></li>
<li><p>任何 Fortran 源代码总是可以转换为等效的 AST 或出现语法错误</p></li>
<li><p>任何 AST 总是可以转换为等效的 ASR 或者出现语义错误</p></li>
</ul>
<p>因此，当可以进行转换时，它们是等效的，并且除非代码无效，否则始终可以进行转换。</p>
</section>
<section id="asr-design-details">
<h2 id="asr-design-details">ASR 设计细节<a class="headerlink" href="#asr-design-details" title="永久链接至标题">¶</a></h2>
<p>ASR 旨在具有以下功能：</p>
<ul class="simple">
<li><p>ASR 在语义上仍然等同于原始 Fortran 代码（它没有丢失任何语义信息）。 ASR 可以转换为 AST，AST 可以转换为 Fortran 源代码，在功能上与原始代码相同。</p></li>
<li><p>ASR 尽可能简单：它不包含任何无法从 ASR 推断出的信息。</p></li>
<li><p>ASR C++ 类（未来）的设计类似于 SymEngine：它们被构造一次，之后它们是不可变的。构造函数在 Debug 中检查是否满足所有要求（例如，函数中的所有变量都有一个虚拟参数集，显式形状数组不可分配以及所有其他 Fortran 要求使其成为有效代码），但在发布模式它无需检查即可快速构建类。然后是构建 ASR C++ 类以满足要求的构建器类（在调试模式下检查），如果代码不是有效的 Fortran 代码，构建器会给出错误消息，如果它没有给出错误消息，则 ASR C++ 类构造正确。因此，通过构造，ASR 类总是包含有效的 Fortran 代码，而 LFortran 的其余部分可以依赖它。</p></li>
</ul>
</section>
<section id="notes">
<h2 id="notes">注意：<a class="headerlink" href="#notes" title="永久链接至标题">¶</a></h2>
<p>将源解析为 AST 时丢失的信息：空格、多行/单行 if 语句区分、关键字的区分大小写。</p>
<p>从 AST 到 ASR 时丢失的信息：如何定义变量的详细语法以及类型属性的顺序（数组维度是否使用 <code class="docutils literal notranslate"><span class="pre">dimension</span></code> 属性，或变量处的括号；或每个声明行有多少个变量或它们的顺序），因为 ASR 仅表示符号表中的聚合类型信息。</p>
<p>ASR 是生成 Fortran 代码的最简单方法，因为不必担心关于如何以及在何处声明事物的详细语法（如在 AST 中）。一个为模块指定符号表，然后为每个符号（函数、全局变量、类型……）指定局部变量，如果这是一个接口，则需要指定在哪里可以找到实现，否则为body 提供了语句，这些节点与 AST 中的几乎相同，除了每个变量只是对符号表中的符号的引用（因此通过构造一个不能有未定义的变量）。每个节点（例如 Function 或 Module）的符号表也引用其父节点（例如，函数引用模块，模块引用全局作用域）。</p>
<p>ASR 可以直接转换为 AST，而无需收集任何其他信息。而AST直接转为Fortran源代码。</p>
<p>ASR 始终表示语义上有效的 Fortran 代码。这是通过检查 ASR C++ 构造函数（在调试版本中）来强制执行的。当使用 ASR 时，可以假定它是有效的。</p>
</section>
<section id="fortran-2008">
<h2 id="fortran-2008">Fortran 2008<a class="headerlink" href="#fortran-2008" title="永久链接至标题">¶</a></h2>
<p>Fortran 2008 <a class="reference external" href="https://j3-fortran.org/doc/year/10/10-007.pdf">标准</a> 第 2 章“Fortran 概念”指定 Fortran 代码是_程序单元_的集合（全部在一个文件中） ，或在单独的文件中），其中每个 <em>程序单元</em> 是以下之一：</p>
<ul class="simple">
<li><p>主程序</p></li>
<li><p>模块或子模块</p></li>
<li><p>函数或子程序</p></li>
</ul>
<p>注意：它也可以是_block data_程序单元，用于为命名的_common blocks_中的数据对象提供初始值，但我们不建议使用_common blocks_（改用模块）。</p>
</section>
<section id="lfortran-extension">
<h2 id="lfortran-extension">LFortran 扩展<a class="headerlink" href="#lfortran-extension" title="永久链接至标题">¶</a></h2>
<p>我们通过引入_全局作用域_来扩展 Fortran 语言，它不仅是_程序单元_列表（如 F2008 中），还可以包括语句、声明、使用语句和表达式。我们将_全局作用域_定义为以下项目的集合：</p>
<ul class="simple">
<li><p>主程序</p></li>
<li><p>模块或子模块</p></li>
<li><p>函数或子程序</p></li>
<li><p>使用声明</p></li>
<li><p>声明</p></li>
<li><p>声明</p></li>
<li><p>表达</p></li>
</ul>
<p>此外，如果变量没有在赋值语句中定义（例如<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">5+3</span></code>），则从右侧推断变量的类型（例如，<code class="docutils literal notranslate"><span class="pre">x</span></code> in <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">5+3</span> </code> 将是 <code class="docutils literal notranslate"><span class="pre">integer</span></code> 类型，而 <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">5._dp</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">y</span></code> 将是 <code class="docutils literal notranslate"><span class="pre">real(dp)</span></code> 类型）。此规则仅适用于 <em>全局作用域</em> 的顶层。类型必须在主程序、模块、函数和子程序中完全指定，就像在 F2008 中一样。</p>
<p><em>全局作用域</em> 有自己的符号表。主程序和模块/子模块看不到此符号表中的任何符号。但是_全局作用域_顶层的函数、子例程、语句和表达式使用和操作这个符号表。</p>
<p><em>全局作用域</em> 在符号表中预定义了以下符号：</p>
<ul class="simple">
<li><p>通常的标准 Fortran 函数集（例如 <code class="docutils literal notranslate"><span class="pre">size</span></code>、<code class="docutils literal notranslate"><span class="pre">sin</span></code>、<code class="docutils literal notranslate"><span class="pre">cos</span></code>…）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dp</span></code> 双精度符号，因此可以使用 <code class="docutils literal notranslate"><span class="pre">5._dp</span></code> 表示双精度。</p></li>
</ul>
<p>_全局作用域_中的每一项解释如下：主程序编译成同名可执行文件并执行；编译和加载模块、函数和子程序； use 语句和声明将那些具有正确类型的符号添加到_全局作用域_符号表中，但不生成任何代码；语句被包装到一个没有参数的匿名子例程中，编译、加载和执行；表达式被包装到一个匿名函数中，没有参数返回表达式，编译、加载、执行并将返回值返回给用户。</p>
<p><em>全局作用域</em> 总是按照上一段逐项解释。它旨在允许交互式使用、实验和编写简单的脚本。 <em>全局作用域</em> 中的代码必须使用 <code class="docutils literal notranslate"><span class="pre">lfortran</span></code> 解释。对于更复杂的（生产）代码，建议将其转换为模块和程序（通过将松散的语句包装成子例程或函数并添加类型声明）并使用 <code class="docutils literal notranslate"><span class="pre">lfortran</span></code> 或任何其他 Fortran 编译器对其进行编译。</p>
<p>以下是 <em>全局作用域</em> 中的一些有效代码示例：</p>
<section id="example-1">
<h3 id="example-1">示例 1<a class="headerlink" href="#example-1" title="永久链接至标题">¶</a></h3>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">a</span>
</pre></div>
</div>
</section>
<section id="example-2">
<h3 id="example-2">示例 2<a class="headerlink" href="#example-2" title="永久链接至标题">¶</a></h3>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>

<span class="k">subroutine </span><span class="n">p</span><span class="p">()</span>
<span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">a</span>
<span class="k">end subroutine</span>

<span class="k">call </span><span class="n">p</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="example-3">
<h3 id="example-3">示例 3<a class="headerlink" href="#example-3" title="永久链接至标题">¶</a></h3>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">module </span><span class="n">a</span>
<span class="k">implicit none</span>
<span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">i</span>
<span class="k">end module</span>

<span class="k">use </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">i</span>
<span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
</pre></div>
</div>
</section>
<section id="example-4">
<h3 id="example-4">示例 4<a class="headerlink" href="#example-4" title="永久链接至标题">¶</a></h3>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span>
<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span>
<span class="k">call </span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="s2">"o-"</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="design-considerations">
<h2 id="design-considerations">设计注意事项<a class="headerlink" href="#design-considerations" title="永久链接至标题">¶</a></h2>
<p>选择 Fortran 的 LFortran 扩展是为了尽量减少更改的数量。特别是，只有_全局作用域_的顶层放宽了一些 Fortran 规则（例如使指定类型可选）以允许简单快速的交互使用，但在函数、子例程、模块或程序内部，这种放宽并不适用.</p>
<p>更改的数量保持在最低限度，以便使用程序和模块将_全局作用域_中的代码直接转换为符合标准的 Fortran 代码，以便任何 Fortran 编译器都可以编译它。</p>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="../progress/" title="LFortran 开发现状"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> LFortran 开发现状 </span>
              </div>
            </a>
          
          
            <a href="../developer_tutorial/" title="开发者教程"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> 开发者教程 </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2022 LFortran contributors.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>