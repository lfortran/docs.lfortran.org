
<!DOCTYPE html>

<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Programming with Generics in LFortran &#8212; LFortran</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/ansi.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/translations.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../../_static/lfortran-logo.svg"/>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Zoeken" href="../../search/" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=amber data-md-color-accent=orange>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#asr/programming_generics" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../" title="LFortran"
           class="md-header-nav__button md-logo">
          
              <img src="../../_static/lfortran-logo.svg" height="26"
                   alt="LFortran logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">LFortran Documentation</span>
          <span class="md-header-nav__topic"> Programming with Generics in LFortran </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../search/" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/lfortran/lfortran" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    LFortran
  </div>
</a>
          </div>
        </div>
      
      
  
  <div class="md-flex__cell md-flex__cell--shrink dropdown">
    <button class="dropdownbutton">Versions</button>
    <div class="dropdown-content md-hero">
          <a title="English" href="/../en/">English</a>
      
          <a title="Bengali" href="/../bn/">Bengali</a>
      
          <a title="Czech" href="/../cs/">Czech</a>
      
          <a title="German" href="/../de/">German</a>
      
          <a title="Spanish" href="/../es/">Spanish</a>
      
          <a title="French" href="/../fr/">French</a>
      
          <a title="Japanese" href="/../ja/">Japanese</a>
      
          <a title="Dutch" href="/../nl/">Dutch</a>
      
          <a title="Polish" href="/../pl/">Polish</a>
      
          <a title="Portuguese" href="/../pt/">Portuguese</a>
      
          <a title="Russian" href="/../ru/">Russian</a>
      
          <a title="Chinese" href="/../zh_CN/">Chinese</a>
      
    </div>
  </div>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../../" class="md-tabs__link">LFortran</a></li>
            
            <li class="md-tabs__item"><a href="../../installation/" class="md-tabs__link">Getting started</a></li>
            
            <li class="md-tabs__item"><a href="../../progress/" class="md-tabs__link">LFortran Development Status</a></li>
            
            <li class="md-tabs__item"><a href="../../design/" class="md-tabs__link">Developers's Guide</a></li>
            
            <li class="md-tabs__item"><a href="../../intrinsics/array/" class="md-tabs__link">Intrinsics</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../" title="LFortran" class="md-nav__button md-logo">
      
        <img src="../../_static/lfortran-logo.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../"
       title="LFortran">LFortran Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/lfortran/lfortran" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    LFortran
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Getting started</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../installation/" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../language/" class="md-nav__link">Fortran Language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../usage/" class="md-nav__link">LFortran User Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">LFortran Development Status</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../progress/" class="md-nav__link">LFortran Development Status</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../progress/#topics" class="md-nav__link">Topics</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Developer's Guide</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../design/" class="md-nav__link">LFortran Design</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../developer_tutorial/" class="md-nav__link">Developer Tutorial</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../ast_and_asr/" class="md-nav__link">Difference between an AST and ASR</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../contributing/" class="md-nav__link">Contributing</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">LFortran Intrinsics</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../intrinsics/array/" class="md-nav__link">Array Intrinsic Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../intrinsics/bit/" class="md-nav__link">Bit Intrinsic Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../intrinsics/character/" class="md-nav__link">Character Intrinsic Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../intrinsics/kind-type/" class="md-nav__link">Kind Type Intrinsic Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../intrinsics/mathematical/" class="md-nav__link">Mathematical Intrinsic Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../intrinsics/numeric/" class="md-nav__link">Numeric Intrinsic Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../intrinsics/misc/" class="md-nav__link">Miscellaneous Intrinsic Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">LFortran ASR Nodes</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../asr_nodes/cast_kind_nodes/cast_kind/" class="md-nav__link">cast_kind</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../asr_nodes/expression_nodes/expression_nodes/" class="md-nav__link">ASR Expression Nodes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../asr_nodes/kinds_nodes/kinds/" class="md-nav__link">kinds</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../asr_nodes/statement_nodes/statement_nodes/" class="md-nav__link">ASR Statement Nodes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../asr_nodes/symbol_nodes/symbol_nodes/" class="md-nav__link">ASR Symbol Nodes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../asr_nodes/type_nodes/ttype/" class="md-nav__link">ttype</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../asr_nodes/omp_nodes/omp_nodes/" class="md-nav__link">ASR OpenMp Nodes</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#asr-programming-generics--page-root" class="md-nav__link">Programming with Generics in LFortran</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#prerequisite" class="md-nav__link">Prerequisite</a>
        </li>
        <li class="md-nav__item"><a href="#defining-and-using-a-generic-function" class="md-nav__link">Defining and Using a Generic Function</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#with-template" class="md-nav__link">With Template</a>
        </li>
        <li class="md-nav__item"><a href="#without-template" class="md-nav__link">Without Template</a>
        </li>
        <li class="md-nav__item"><a href="#further-simplifying-instantiations" class="md-nav__link">Further Simplifying Instantiations</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#generic-derived-types" class="md-nav__link">Generic Derived Types</a>
        </li>
        <li class="md-nav__item"><a href="#see-also" class="md-nav__link">See Also</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="programming-with-generics-in-lfortran">
<h1 id="asr-programming-generics--page-root">Programming with Generics in LFortran<a class="headerlink" href="#asr-programming-generics--page-root" title="Permalink naar deze titel">¶</a></h1>
<p>In this page we will explore how to write generics in LFortran.</p>
<section id="prerequisite">
<h2 id="prerequisite">Prerequisite<a class="headerlink" href="#prerequisite" title="Permalink naar deze titel">¶</a></h2>
<p>Variables inside of a generic function are typed with a <em>deferred types</em>. For example, we may want to define a function that calculate the sum of a generic array which can take any number type. Using a deferred type <code class="docutils literal notranslate"><span class="pre">T</span></code>, we may want to declare the following generic function:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">function </span><span class="n">array_sum</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">arr</span><span class="p">(:)</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">r</span>
<span class="w">  </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set_to_zero</span><span class="p">()</span>
<span class="w">  </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">    </span><span class="c">! uses a function instead of + because T </span>
<span class="w">    </span><span class="c">! can be any type, even a derived type</span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add_element</span><span class="p">(</span><span class="n">arr</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
<span class="w">  </span><span class="k">end do</span>
<span class="k">end function</span>
</pre></div>
</div>
<p>As we can see here, we need to define the functions associated with the deferred type <code class="docutils literal notranslate"><span class="pre">T</span></code>. To do so in LFortran, we use <em>requirements</em> to define both deferred types and their associated functions.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">requirement</span><span class="w"> </span><span class="n">number_type</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">add_element</span><span class="p">,</span><span class="w"> </span><span class="n">set_to_zero</span><span class="p">)</span>
<span class="w">  </span><span class="k">type</span><span class="p">,</span><span class="w"> </span><span class="k">deferred</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">T</span>
<span class="w">  </span><span class="k">function </span><span class="n">add_element</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">z</span>
<span class="w">  </span><span class="k">end function</span>
<span class="k">  function </span><span class="n">set_to_zero</span><span class="p">()</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">z</span>
<span class="w">  </span><span class="k">end function</span>
<span class="k">end </span><span class="n">requirement</span>
</pre></div>
</div>
</section>
<section id="defining-and-using-a-generic-function">
<h2 id="defining-and-using-a-generic-function">Defining and Using a Generic Function<a class="headerlink" href="#defining-and-using-a-generic-function" title="Permalink naar deze titel">¶</a></h2>
<p>Having defined the necessary requirement to use the deferred type <code class="docutils literal notranslate"><span class="pre">T</span></code>, we can proceed to define our generic array sum. LFortran provides two different ways to write and instantiate generic functions:</p>
<ol class="arabic simple">
<li><p>With a template</p></li>
<li><p>Without a template (simpler syntax)</p></li>
</ol>
<section id="with-template">
<h3 id="with-template">With Template<a class="headerlink" href="#with-template" title="Permalink naar deze titel">¶</a></h3>
<p><strong>Defining a generic function</strong></p>
<p>A template works as a closure for a generic function. A template takes as parameters symbols that would replace the generic symbols inside a generic function.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">template</span><span class="w"> </span><span class="n">array_t</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">add_element</span><span class="p">,</span><span class="w"> </span><span class="n">set_to_zero</span><span class="p">)</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">array_sum</span>
<span class="k">contains</span>
<span class="k">  function </span><span class="n">array_sum</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">arr</span><span class="p">(:)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">r</span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">i</span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set_to_zero</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">      </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add_element</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">arr</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="w">      </span><span class="k">end do</span>
<span class="k">    end if</span>
<span class="k">  end function</span>
<span class="k">end </span><span class="n">template</span>
</pre></div>
</div>
<p>Then to connect the parameters with the functions defined in the requirement, we use a <code class="docutils literal notranslate"><span class="pre">require</span></code> statement.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">template</span><span class="w"> </span><span class="n">array_t</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">add_element</span><span class="p">,</span><span class="w"> </span><span class="n">set_to_zero</span><span class="p">)</span>
<span class="w">  </span><span class="n">require</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">number_type</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">add_element</span><span class="p">,</span><span class="w"> </span><span class="n">set_to_zero</span><span class="p">)</span>
<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">array_sum</span>
<span class="k">contains</span>
<span class="k">  function </span><span class="n">array_sum</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">arr</span><span class="p">(:)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">r</span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">i</span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set_to_zero</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">      </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add_element</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">arr</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="w">      </span><span class="k">end do</span>
<span class="k">    end if</span>
<span class="k">  end function</span>
<span class="k">end </span><span class="n">template</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">require</span> <span class="pre">::</span> <span class="pre">number_type(T,</span> <span class="pre">add_element,</span> <span class="pre">set_to_zero)</span></code> sets the type signature for the parameters within the scope of the template. This makes it possible for the LFortran compiler to type check the computations associated with the deferred type <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
<p>A template can also contains multiple functions that may depend on each other.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">template</span><span class="w"> </span><span class="n">array_t</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">add_element</span><span class="p">,</span><span class="w"> </span><span class="n">set_to_zero</span><span class="p">)</span>
<span class="w">  </span><span class="n">require</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">number_type</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">add_element</span><span class="p">,</span><span class="w"> </span><span class="n">set_to_zero</span><span class="p">)</span>
<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">array_sum</span>
<span class="k">contains</span>
<span class="k">  function </span><span class="n">array_sum</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">arr</span><span class="p">(:)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">r</span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">i</span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set_to_zero</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">      </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add_element</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">arr</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="w">      </span><span class="k">end do</span>
<span class="k">    end if</span>
<span class="k">  end function</span>
<span class="k">  </span>
<span class="k">  function </span><span class="n">array_avg</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">arr</span><span class="p">(:)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">s</span>
<span class="w">    </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array_sum</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">  </span><span class="k">end function</span>
<span class="k">end </span><span class="n">template</span>
</pre></div>
</div>
<p><strong>Using a generic function</strong></p>
<p>To use a generic function we first need to instantiate (replace) the generic symbols inside a template with symbols with concrete types. The instantiation is done through the <code class="docutils literal notranslate"><span class="pre">instantiate</span></code> statement. For example, if we want to instantiate ‘array_sum’ with integer types, the instantiation would be as follows:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">instantiate</span><span class="w"> </span><span class="n">array_t</span><span class="p">(</span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="n">add_element_integer</span><span class="p">,</span><span class="w"> </span><span class="n">set_to_zero_integer</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">  </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">array_sum_integer</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">array_sum</span>
</pre></div>
</div>
<p>First we pass the concrete symbols to the template in the form of a template call <code class="docutils literal notranslate"><span class="pre">array_t(integer,</span> <span class="pre">add_element_integer,</span> <span class="pre">set_to_zero_integer)</span></code>. We are replacing the deferred type <code class="docutils literal notranslate"><span class="pre">T</span></code> with a concrete type <code class="docutils literal notranslate"><span class="pre">integer</span></code>, <code class="docutils literal notranslate"><span class="pre">add_element</span></code> with a function that computes addition between two integers <code class="docutils literal notranslate"><span class="pre">add_element_integer</span></code>, and <code class="docutils literal notranslate"><span class="pre">set_to_zero</span></code> with a function that returns a zero integer value <code class="docutils literal notranslate"><span class="pre">set_to_zero_integer</span></code>. These functions would have to be defined prior to the instantiation for them to be passed as symbol arguments to a template:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">function </span><span class="n">add_element_integer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>
<span class="w">  </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">z</span>
<span class="w">  </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span>
<span class="k">end function</span>

<span class="k">function </span><span class="n">set_to_zero_integer</span><span class="p">()</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="w">  </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">z</span>
<span class="w">  </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="k">end function</span>
</pre></div>
</div>
<p>After <code class="docutils literal notranslate"><span class="pre">only:</span> </code> we decide which function inside in the template we want to instantiate, in this case <code class="docutils literal notranslate"><span class="pre">array_sum</span></code>, and give the new instantiated function a new name <code class="docutils literal notranslate"><span class="pre">array_sum_integer</span></code>.</p>
<p>After instantiation, we can then use the instantiated function similar to ordinary functions:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">arr</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="nb">sum</span>
<span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array_sum_integer</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</pre></div>
</div>
<p>The main benefit of generics is reuse. We can have different instantiations for different types using the same template. For example we can instantiate both integer and real <code class="docutils literal notranslate"><span class="pre">array_sum</span></code>:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! instantiation with integer type</span>
<span class="n">instantiate</span><span class="w"> </span><span class="n">array_t</span><span class="p">(</span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="n">add_element_integer</span><span class="p">,</span><span class="w"> </span><span class="n">set_to_zero_integer</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">  </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">array_sum_integer</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">array_sum</span>

<span class="c">! instantiation with real type</span>
<span class="n">instantiate</span><span class="w"> </span><span class="n">array_t</span><span class="p">(</span><span class="kt">real</span><span class="p">,</span><span class="w"> </span><span class="n">add_element_real</span><span class="p">,</span><span class="w"> </span><span class="n">set_to_zero_real</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">  </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">array_sum_real</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">array_sum</span>
</pre></div>
</div>
<p>Also, because a template may contain multiple generic functions, a single instantiation can be used to instantiate multiple functions:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">instantiate</span><span class="w"> </span><span class="n">array_t</span><span class="p">(</span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="n">add_element_integer</span><span class="p">,</span><span class="w"> </span><span class="n">set_to_zero_integer</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">  </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">array_sum_integer</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">array_sum</span><span class="p">,</span><span class="w"> </span><span class="n">array_avg_integer</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">array_avg</span>

<span class="n">instantiate</span><span class="w"> </span><span class="n">array_t</span><span class="p">(</span><span class="kt">real</span><span class="p">,</span><span class="w"> </span><span class="n">add_element_real</span><span class="p">,</span><span class="w"> </span><span class="n">set_to_zero_real</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">  </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">array_sum_real</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">array_sum</span><span class="p">,</span><span class="w"> </span><span class="n">array_avg_real</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">array_avg</span>
</pre></div>
</div>
</section>
<section id="without-template">
<h3 id="without-template">Without Template<a class="headerlink" href="#without-template" title="Permalink naar deze titel">¶</a></h3>
<p>The template notation can be cumbersome for defining a single generic function. To alleviate this, LFortran also supports a simpler syntax for declaring generic functions without having to declare an enclosing template. For example, our running <code class="docutils literal notranslate"><span class="pre">array_sum</span></code> example can be written as follows in the simpler syntax:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span>function generic_sum {T, add_element, set_to_zero} (arr) result(r)
  require :: number_type(T, add_element, set_to_zero)
  type(T), intent(in) :: arr(:)
  type(T) :: r
  integer :: n, i
  n = size(arr)
  r = set_to_zero(0)
  if (n &gt; 0) then
    r = arr(1)
    do i = 2, n
      res = add_element(r, arr(i))
    end do
  end if
end function
</pre></div>
</div>
<p>The first difference is that the template parameters are now included as the function’s generic symbol parameters enclosed by braces <code class="docutils literal notranslate"><span class="pre">{T,</span> <span class="pre">add_element,</span> <span class="pre">set_to_zero}</span></code>. Since we still need to identify these generic symbols a requirement, the require statement is moved into the generic function itself. The rest of the function is the same as the generic function inside the template.</p>
<p>This is merely a syntax sugar for the original templated function. Inside the compiler this generic function is treated as the following template:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">template</span><span class="w"> </span><span class="n">generic_sum</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">add_element</span><span class="p">,</span><span class="w"> </span><span class="n">set_to_zero</span><span class="p">)</span>
<span class="w">  </span><span class="n">require</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">number_type</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">add_element</span><span class="p">,</span><span class="w"> </span><span class="n">set_to_zero</span><span class="p">)</span>
<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">generic_sum</span>
<span class="k">contains</span>
<span class="k">  function </span><span class="n">generic_sum</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">arr</span><span class="p">(:)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">r</span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">i</span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set_to_zero</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">      </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add_element</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">arr</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="w">      </span><span class="k">end do</span>
<span class="k">    end if</span>
<span class="k">  end function</span>
<span class="k">end </span><span class="n">template</span>
</pre></div>
</div>
<p>The instantiation is also made simpler by having the instantiation and function call together:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span>integer :: arr(10), sum
sum = array_sum{integer, add_element_integer, set_to_zero_integer}(arr)
</pre></div>
</div>
</section>
<section id="further-simplifying-instantiations">
<h3 id="further-simplifying-instantiations">Further Simplifying Instantiations<a class="headerlink" href="#further-simplifying-instantiations" title="Permalink naar deze titel">¶</a></h3>
<p><strong>Passing operator instead of functions</strong></p>
<p>So far to replace the generic addition <code class="docutils literal notranslate"><span class="pre">add_element</span></code> we have used a concrete function <code class="docutils literal notranslate"><span class="pre">add_element_integer</span></code>. To simplify this, it is possible to just pass <code class="docutils literal notranslate"><span class="pre">operator(+)</span></code> without having to define a function separately:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">instantiate</span><span class="w"> </span><span class="n">array_t</span><span class="p">(</span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="n">operator</span><span class="p">(</span><span class="o">+</span><span class="p">),</span><span class="w"> </span><span class="n">set_to_zero_integer</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">  </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">array_sum_integer</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">array_sum</span>
</pre></div>
</div>
<p><strong>Skipping function instantiation names</strong></p>
<p>Generic functions can also be instantiated without having to rename each function one-by-one. Suppose we want to instantiate every generic functions inside the template <code class="docutils literal notranslate"><span class="pre">array_t</span></code>, we can shorten the instantiation into:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">instantiate</span><span class="w"> </span><span class="n">array_t</span><span class="p">(</span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="n">operator</span><span class="p">(</span><span class="o">+</span><span class="p">),</span><span class="w"> </span><span class="n">set_to_zero_integer</span><span class="p">)</span>
</pre></div>
</div>
<p>Doing so would generate the function <code class="docutils literal notranslate"><span class="pre">array_sum</span></code> and <code class="docutils literal notranslate"><span class="pre">array_avg</span></code> without any renaming.</p>
</section>
</section>
<section id="generic-derived-types">
<h2 id="generic-derived-types">Generic Derived Types<a class="headerlink" href="#generic-derived-types" title="Permalink naar deze titel">¶</a></h2>
<p>LFortran also supports generic derived types. Let’s say we want a generic tuple. We can define a derived type for tuples as usual inside a template:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">template</span><span class="w"> </span><span class="n">derived_type_t</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="w">    </span><span class="c">! for brevity we have the deferred type</span>
<span class="w">    </span><span class="c">! declared directly inside the template</span>
<span class="w">    </span><span class="k">type</span><span class="p">,</span><span class="w"> </span><span class="k">deferred</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">T</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tuple</span>

<span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tuple</span>
<span class="w">      </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">fst</span>
<span class="w">      </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">snd</span>
<span class="w">    </span><span class="k">end type</span>
<span class="k">end </span><span class="n">template</span>
</pre></div>
</div>
<p>We can also define generic functions accessing this generic tuple as:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">template</span><span class="w"> </span><span class="n">derived_type_t</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="w">    </span><span class="k">type</span><span class="p">,</span><span class="w"> </span><span class="k">deferred</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">T</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tuple</span>

<span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tuple</span>
<span class="w">      </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">fst</span>
<span class="w">      </span><span class="k">type</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">snd</span>
<span class="w">    </span><span class="k">end type</span>
<span class="k">contains</span>
<span class="k">    function </span><span class="n">get_fst</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="w">      </span><span class="k">type</span><span class="p">(</span><span class="n">tuple</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">p</span>
<span class="w">      </span><span class="k">type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">r</span>
<span class="w">      </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">%</span><span class="n">fst</span>
<span class="w">    </span><span class="k">end function</span>

<span class="k">    function </span><span class="n">get_snd</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="w">      </span><span class="k">type</span><span class="p">(</span><span class="n">tuple</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">p</span>
<span class="w">      </span><span class="k">type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">r</span>
<span class="w">      </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">%</span><span class="n">snd</span>
<span class="w">    </span><span class="k">end function</span>
<span class="k">end </span><span class="n">template</span>
</pre></div>
</div>
<p>The instantiation for derived types are also similar to generic functions. If we want an integer tuple type and its functions, then we can instantiate <code class="docutils literal notranslate"><span class="pre">derived_type_t</span></code> as:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">instantiate</span><span class="w"> </span><span class="n">derived_type_t</span><span class="p">(</span><span class="kt">integer</span><span class="p">),</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">  </span><span class="n">tuple_int</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">tuple</span><span class="p">,</span><span class="w"> </span><span class="n">get_fst_int</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">get_fst</span><span class="p">,</span><span class="w"> </span><span class="n">get_snd_int</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">get_snd</span>
</pre></div>
</div>
</section>
<section id="see-also">
<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permalink naar deze titel">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../generics/"><span class="doc std std-doc">Generics</span></a>, for details about the generics implementation and its related ASR.</p></li>
</ul>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2022 LFortran contributors.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>